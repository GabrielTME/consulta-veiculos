<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta de Ve√≠culo 2.0</title>
  <style>
    body { margin: 0; font-family: 'Helvetica', 'Arial', sans-serif; display: flex; height: 100vh; min-height: 0; background: #161717; }
    
    .form-container { 
      background: #222222; 
      color: #f0f0f0;
      border-right: 1px solid #3d3d3d; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      flex: 1 1 0; 
      overflow-y: auto; 
      padding: 30px 20px;
    }
    .form-container > div { max-width: 400px; width: 100%; }

    .field-group { margin-bottom: 18px; border-bottom: 1px solid #333; padding-bottom: 14px; }
    
    label { 
      display: block; 
      font-weight: normal; 
      margin-bottom: 8px; 
      color: #7FDB5C; 
      font-size: 12px; 
      text-transform: uppercase; 
      letter-spacing: 1px; 
    }
    
    input[type="text"], select { 
      width: 100%; padding: 12px; border-radius: 6px; 
      border: 1px solid #444; background: #2d2d2d; color: #fff; 
      font-size: 14px; transition: border-color 0.3s, box-shadow 0.3s;
    }
    
    input[type="text"]:focus, select:focus { 
      outline: none; border-color: #7FDB5C; box-shadow: 0 0 0 2px rgba(127, 219, 92, 0.2); 
    }

    .buttons { display: flex; gap: 12px; margin-top: 25px; }
    button { 
      flex: 1; padding: 14px; border-radius: 8px; border: none; 
      font-weight: bold; cursor: pointer; transition: transform 0.1s, background 0.2s; 
    }
    button:active { transform: scale(0.97); }
    .btn-copiar { background: #7FDB5C; color: #1a1a1a; font-size: 15px; }
    .btn-limpar { background: #444; color: #ddd; }
    
    .plus-button { 
      background: #7FDB5C; color: #1a1a1a; border-radius: 6px; width: 34px; height: 34px; 
      display: flex; align-items: center; justify-content: center; border: none; font-size: 22px; margin-top: 8px;
    }

    .checkbox-wrap { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #ccc; cursor: pointer; margin-top: 5px; }
    input[type="checkbox"] { accent-color: #7FDB5C; width: 18px; height: 18px; cursor: pointer; }

    .preview-container { background: #161717; display: flex; align-items: center; justify-content: center; flex: 1 1 0; min-height: 0; }
    .whatsapp-message { background: #144D37; color: #e9edef; border-radius: 7.5px; padding: 14px 18px; max-width: 600px; font-size: 18px; line-height: 1.5; white-space: pre-wrap; box-shadow: 0 1px 0.5px rgba(0,0,0,0.13); }
    #previewMsg b { font-weight: bold; }
    
    .debito-linha { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; }
    .debito-linha input[type="text"] { flex: 1; }
  </style>
</head>
<body>
  <div class="form-container">
    <div>
      <div class="field-group">
        <label>Ve√≠culo</label>
        <div style="display: flex; gap: 6px;">
          <input type="text" id="marca" oninput="atualizarPreview()">
          <input type="text" id="modelo" oninput="atualizarPreview()">
          <input type="text" id="ano" oninput="atualizarPreview()">
        </div>
      </div>

      <div class="field-group">
        <label>Propriet√°rio</label>
        <input type="text" id="proprietario" oninput="atualizarPreview()">
        <label class="checkbox-wrap"><input type="checkbox" id="proprietarioCnpj" onchange="atualizarPreview()"> CNPJ</label>
      </div>

      <div class="field-group">
        <label>Munic√≠pio / Proced√™ncia</label>
        <input type="text" id="emplacadoEm" oninput="atualizarPreview()">
        <label class="checkbox-wrap"><input type="checkbox" id="temAnterior" onchange="atualizarPreview()"> Proced√™ncia anterior</label>
        <input type="text" id="emplacadoAnterior" style="display: none; margin-top:8px;" oninput="atualizarPreview()">
      </div>

      <div class="field-group">
        <label>Financiamento</label>
        <div style="display: flex; gap: 15px; margin-bottom: 10px;">
          <label class="checkbox-wrap"><input type="checkbox" id="temFinanciamento" onchange="atualizarPreview()"> Possui</label>
          <label class="checkbox-wrap"><input type="checkbox" id="financiamentoIncluso" onchange="atualizarPreview()"> A incluir</label>
        </div>
        <div id="financiamentoCampos" style="display: none; flex-direction: column; gap: 8px;">
          <div style="display: flex; gap: 6px;">
            <select id="financiamentoSelect" onchange="document.getElementById('financiamentoInfo').value = this.value; atualizarPreview();" style="flex: 1;">
              <option value="">Banco</option>
              <option value="Aymor√©">Aymor√©</option>
              <option value="Daycoval">Daycoval</option>
              <option value="PAN">PAN</option>
              <option value="C6">C6</option>
              <option value="Votorantim">Votorantim</option>
              <option value="Sicredi">Sicredi</option>
              <option value="Sicoob">Sicoob</option>
              <option value="Digimais">Digimais</option>
              <option value="Bradesco">Bradesco</option>
            </select>
            <input type="text" id="financiamentoInfo" style="flex: 1.5;" oninput="atualizarPreview()">
          </div>
          <input type="text" id="dataContrato" oninput="atualizarPreview()">
        </div>
      </div>

      <div class="field-group">
        <label>Restri√ß√£o Judicial / Adm.</label>
        <label class="checkbox-wrap" style="margin-bottom:10px;"><input type="checkbox" id="temRenajud" onchange="atualizarPreview()"> Possui</label>
        <select id="renajudTipo" style="display: none;" onchange="atualizarPreview()">
          <option value="transfer√™ncia">RENAJUD de transfer√™ncia</option>
          <option value="licenciamento">RENAJUD de licenciamento</option>
          <option value="circula√ß√£o">RENAJUD de circula√ß√£o</option>
          <option value="penhora">RENAJUD de penhora</option>
          <option value="execucao-certidao">Execu√ß√£o por certid√£o</option>
          <option value="administrativa">Administrativa</option>
          <option value="averbacao">Averba√ß√£o</option>
        </select>
      </div>

      <div class="field-group">
        <label>Venda (Inten√ß√£o/Comunica√ß√£o)</label>
        <div style="display: flex; gap: 20px; margin-bottom: 10px;">
          <label class="checkbox-wrap"><input type="checkbox" id="temIntencao" onchange="atualizarPreview()"> Inten√ß√£o</label>
          <label class="checkbox-wrap"><input type="checkbox" id="temComunicacao" onchange="atualizarPreview()"> Comunic.</label>
        </div>
        <input type="text" id="nomeIntencao" style="display: none; margin-bottom:8px;" oninput="atualizarPreview()">
        <input type="text" id="dataInclusaoIntencao" style="display: none;" oninput="atualizarPreview()">
      </div>

      <div class="field-group">
        <label>Observa√ß√µes</label>
        <label class="checkbox-wrap" style="margin-bottom:10px;"><input type="checkbox" id="temObservacao" onchange="atualizarPreview()"> Adicionar</label>
        <input type="text" id="observacaoTexto" style="display: none;" oninput="atualizarPreview()">
      </div>

      <div class="field-group">
        <label>D√©bitos</label>
        <div id="debitosContainer"></div>
        <button class="plus-button" type="button" onclick="adicionarDebito()">+</button>
      </div>

      <div class="field-group">
        <label>Valor total</label>
        <input type="text" id="debitoValor" oninput="atualizarPreview()">
      </div>

      <div class="field-group" style="border-bottom: none;">
        <label>Multas para entrar no sistema</label>
        <div style="display: flex; gap: 6px;">
          <input type="text" id="quantidadeMultas" style="flex: 0.5;" oninput="atualizarPreview()">
          <input type="text" id="valorMultas" style="flex: 1.5;" oninput="atualizarPreview()">
        </div>
      </div>

      <div class="buttons">
        <button class="btn-copiar" onclick="copiarMensagem()">Copiar</button>
        <button class="btn-limpar" onclick="limparCampos()">Limpar</button>
      </div>
    </div>
  </div>

  <div class="preview-container">
    <div class="whatsapp-message" id="previewMsg">Preencha os campos para gerar a consulta...</div>
  </div>

  <script>
    function capitalizeWords(str) {
      const dWords = ['de', 'da', 'do', 'das', 'dos'];
      return str.toLowerCase().replace(/(?:^|\s|[.])[a-z√†-√∫]/g, m => m.toUpperCase())
                .replace(/\b([Dd][aeo]s?)\b/g, m => dWords.includes(m.toLowerCase()) ? m.toLowerCase() : m);
    }

    function formatarProprietario(str) {
      let texto = capitalizeWords(str);
      texto = texto.replace(/\bltda\b/gi, 'LTDA').replace(/\bme\b/gi, 'ME').replace(/\bE\b/g, 'e');
      return texto;
    }

    function onInputCapitalize(e) {
      const start = e.target.selectionStart;
      const end = e.target.selectionEnd;
      const newValue = (e.target.id === 'proprietario') ? formatarProprietario(e.target.value) : capitalizeWords(e.target.value);
      if (e.target.value !== newValue) { e.target.value = newValue; e.target.setSelectionRange(start, end); }
    }

    function adicionarDebito() {
      const container = document.getElementById('debitosContainer');
      const count = container.querySelectorAll('.debito-linha').length;
      const linha = document.createElement('div');
      linha.className = 'debito-linha';
      const input = document.createElement('input');
      input.type = 'text'; input.className = 'descricaoDebito'; input.addEventListener('input', atualizarPreview);
      linha.appendChild(input);
      if (count === 0) {
          const cb = document.createElement('input'); cb.type = 'checkbox'; cb.id = 'veiculoEmDiaCheckbox';
          cb.addEventListener('change', atualizarPreview);
          linha.appendChild(cb);
      }
      container.appendChild(linha);
    }

    function formatarValor(valor) {
      const numero = parseFloat(valor.replace(/[^0-9]/g, ''));
      return isNaN(numero) ? '' : 'R$' + numero.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function gerarTextoMensagem() {
      const f = (id) => document.getElementById(id).value;
      const v = (id) => document.getElementById(id).checked;

      const marca = f('marca'), modelo = f('modelo'), ano = capitalizeWords(f('ano'));
      const empEm = f('emplacadoEm'), empAnt = v('temAnterior') ? f('emplacadoAnterior') : '';
      const prop = formatarProprietario(f('proprietario')), propCnpj = v('proprietarioCnpj');
      const finan = v('temFinanciamento') ? f('financiamentoInfo') : '', finanInc = v('financiamentoIncluso'), dataCont = capitalizeWords(f('dataContrato'));
      const temRen = v('temRenajud'), renTipo = f('renajudTipo');
      const valTot = formatarValor(f('debitoValor')), qtdMul = parseInt(f('quantidadeMultas') || '0'), valMul = formatarValor(f('valorMultas'));
      const diaCb = document.getElementById('veiculoEmDiaCheckbox')?.checked;
      const temInt = v('temIntencao'), temCom = v('temComunicacao'), nomeInt = capitalizeWords(f('nomeIntencao')), dataInt = f('dataInclusaoIntencao');
      const temObs = v('temObservacao'), obsTxt = f('observacaoTexto');

      let msg = `üöó *DADOS DO VE√çCULO*\n`;
      if (marca || modelo || ano) msg += `‚Ä¢ *Modelo:* ${marca} ${modelo} ${ano}\n`;
      if (prop) msg += `‚Ä¢ *Propriet√°rio:* ${prop}${propCnpj ? ' (CNPJ)' : ''}\n`;
      if (empEm) msg += `‚Ä¢ *Munic√≠pio:* ${empEm}${empAnt ? ` (Proced√™ncia anterior: ${empAnt})` : ''}\n`;

      msg += `\n‚ö†Ô∏è *RESTRI√á√ïES E PEND√äNCIAS*\n`;
      
      let statusFinan = finanInc ? "a ser inclu√≠do" : "ativo";
      let txtFinan = finan ? `Possui financiamento ${statusFinan} (Banco *${finan}*${dataCont ? ', contrato de ' + dataCont : ''})` : "N√£o possui";
      msg += `‚Ä¢ *Aliena√ß√£o:* ${txtFinan}\n`;

      let txtRen = "N√£o possui";
      if (temRen) {
        txtRen = renTipo === 'execucao-certidao' ? "Possui restri√ß√£o de execu√ß√£o por certid√£o" : 
                 renTipo === 'administrativa' ? "Possui restri√ß√£o administrativa" : 
                 renTipo === 'averbacao' ? "Possui averba√ß√£o de execu√ß√£o por certid√£o" : `Consta bloqueio RENAJUD de ${renTipo}`;
        txtRen += " üö´";
      }
      msg += `‚Ä¢ *Restri√ß√£o Judicial:* ${txtRen}\n`;

      let txtVenda = "N√£o possui";
      if ((temInt || temCom) && nomeInt) {
        txtVenda = `${temInt && temCom ? 'Inten√ß√£o/Comunica√ß√£o' : temInt ? 'Inten√ß√£o' : 'Comunica√ß√£o'} registrada para ${nomeInt}${dataInt ? ` em ${dataInt}` : ''}`;
      }
      msg += `‚Ä¢ *Venda:* ${txtVenda}\n`;

      if (temObs && obsTxt) msg += `\nüîç *OBSERVA√á√ïES*\n‚Ä¢ ${obsTxt}\n`;

      msg += `\nüí∞ *D√âBITOS*\n`;
      const debs = Array.from(document.querySelectorAll('.descricaoDebito')).map(i => i.value.trim()).filter(v => v);
      
      const hasMultas = qtdMul > 0;

      if (debs.length > 0) {
        debs.forEach((d, i) => {
            const isLastLine = (i === debs.length - 1);
            msg += `‚Ä¢ ${d}${isLastLine ? ' =' : ' +'}\n`;
        });
        if (valTot) msg += `‚Ä¢ *VALOR TOTAL:* ${valTot}\n`;
      } else {
        msg += `‚Ä¢ Sem d√©bitos, ve√≠culo em dia (2026)\n`;
      }

      if (diaCb) msg += `\nVe√≠culo em dia (2025)\n`;

      if (qtdMul > 0) {
        let txtM = qtdMul === 1 ? '1 multa que ainda n√£o caiu no sistema' : `${qtdMul} multas que ainda n√£o ca√≠ram no sistema`;
        msg += `\n${txtM}${valMul ? ` (valor total de ${valMul})` : ''}\n`;
      }

      return msg.trim();
    }

    function atualizarPreview() {
      const m = gerarTextoMensagem();
      document.getElementById('previewMsg').innerHTML = m.replace(/\*([^\*]+)\*/g, '<b>$1</b>');
      const v = (id) => document.getElementById(id).checked;
      
      document.getElementById('nomeIntencao').style.display = document.getElementById('dataInclusaoIntencao').style.display = (v('temIntencao') || v('temComunicacao')) ? 'block' : 'none';
      document.getElementById('observacaoTexto').style.display = v('temObservacao') ? 'block' : 'none';
      document.getElementById('emplacadoAnterior').style.display = v('temAnterior') ? 'block' : 'none';
      document.getElementById('financiamentoCampos').style.display = v('temFinanciamento') ? 'flex' : 'none';
      document.getElementById('renajudTipo').style.display = v('temRenajud') ? 'block' : 'none';
    }

    function copiarMensagem() {
      const m = gerarTextoMensagem();
      navigator.clipboard.writeText(m).then(() => alert('‚úÖ'));
    }

    function limparCampos() {
      document.querySelectorAll('input[type="text"]').forEach(i => i.value = '');
      document.querySelectorAll('input[type="checkbox"]').forEach(c => c.checked = false);
      document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
      document.getElementById('debitosContainer').innerHTML = '';
      for(let i=0; i<3; i++) adicionarDebito();
      atualizarPreview();
    }

    window.onload = () => {
      document.querySelectorAll('input[type="text"]').forEach(i => {
        if (!['marca','modelo','observacaoTexto','financiamentoInfo','emplacadoAnterior','emplacadoEm','quantidadeMultas','valorMultas'].includes(i.id)) i.addEventListener('input', onInputCapitalize);
      });
      for(let i=0; i<3; i++) adicionarDebito();
      atualizarPreview();
    };
  </script>
</body>
</html>

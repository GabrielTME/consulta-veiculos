<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta de Ve√≠culo 2.0</title>
  
  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsEAAA7BAbiRa+0AAAAZdEVYdFNvZnR3YXJlAFBhaW50Lk5FVCA1LjEuMTGKCBbOAAAAuGVYSWZJSSoACAAAAAUAGgEFAAEAAABKAAAAGwEFAAEAAABSAAAAKAEDAAEAAAADAAAAMQECABEAAABaAAAAaYcEAAEAAABsAAAAAAAAAJOTAADoAwAAk5MAAOgDAABQYWludC5ORVQgNS4xLjExAAADAACQBwAEAAAAMDIzMAGgAwABAAAAAQAAAAWgBAABAAAAlgAAAAAAAAACAAEAAgAEAAAAUjk4AAIABwAEAAAAMDEwMAAAAABcUYo7t3MiWAAABDdJREFUWEfFl0tsFWUUx39n2gYpJgqYVIIhkvD5ADYYiI0pReLCTTVCdAHO8BB14UJJEONC+s3ACouiiUbRII8ZG4hEJRBjIEEeIYak1hjFYL6GBVGhPlBBA4WUz0Vn2unpvW0pJv6Su7j//5k5Z8797rnnCtdJ7KImj38VmAaMy+WLwDngO+ALQQ7FJu1Wl1ZEtKCJXXSvUPOPNdvPAKxzSySgpgV4B5iq43N+Bz4GeSMx6ffaLFO1gNgtq/dci4HngcvADmBjYrKfAawLpwC7gfn62hKXgTcFSWKTXtIm1QqwLrobfDtwn7J+AdYkJssAWt2TEwTZCzyk4jQdIEsTkzptDCkgdtFcj98PNGivRFtispcA1nc9NanXX9kLNAK1OrDEWaAlMVlnWRxUQP7kR0ZIniObEpOuBdjQtaqu11+Z7vHzgWVAs47OOQuyoNyJ/gJiF9V7/LEKbR+O5YnJdmrRurAFeA24S3tAhyDNxZkICtXj4yrJdwNLgAvaAF6PXTRNi4nJ9gtyP7BPe8Bcj7fFm4C+1s/KT7vm01qpW5qYbBfIE8AV5U/2+FalARCb9M8aqV1UpYgXrItmMtABv7o0VApOCbJi3Yxt1wASkx4AXlQxACuti2ZrEaB1xvZeQZYD+vTflOcksC66HVisAgDWxCb9qyyMDya8BewCTgHf5q/T4B8ox5WJTfpHlcIXxy5qEOvCJUC7Mo8kJntQaf1YF9YCPn8rgCQmu6rCBmFdeAxoUvJSsS58D3hGGasSk32gtBvCuvBZYIuS3w8A/fldEuSQ0m4YQY6WulYwR6wLTwPTS2IPcBy4qgfVMIwD3k5M9pE2CmIX1Xl8cx7r83v/LdaFvwK36QvGwMbEZC9rcST6B9H/RZAvE/8FY7pPAPymxTHyoxZGg1gXzgPuAHq1OQybADNYksbEpCcGawNYFz4GPJcfcvqmIXtGe8r7iV10p8efBOpL8k+CzNKTs4x14XFAT8yV130IPX6tSg5weITkj1ZIfl6QzyUPmAnMy7/7BV6Qz8o3ti5qBH8UqCvFATycmOyA0qCvYxM9/sTQj4yticmeLjowHtgOfFh6tXv8tg1dfV2KXTQZ/NYKyb8cH9x8UGkArO9aUePxOyok7wHZTHnSWRe2VfnV2iPIKx6/BVigzWpPH7voVo/fCTyivfJO2X8GBLHA14PC+njc47+pkvzdSsmtC1vytldK3ikEcfFGL6X3gD88uqWUrwKChdbsvBi7ZRPATx3FUtqdL6U/FMKQr2E+F/aNoohu4Ey+ik8EplTYqsp0C9ISm7SjLA4pgIFOtANztDdGOvM/Jv1PXlBxDiQmPSVIUz7xisk1FnqANiGYXyk51TpQxrpwNrAaWARM0n4VzgOfgGxOTHpSm2VGLKDAumgK+IXAwnyLagBuyZeLC/mZKP89P6fvUYl/AU+EZ2F2S8GBAAAAAElFTkSuQmCC">
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { margin: 0; font-family: 'Helvetica', 'Arial', sans-serif; display: flex; height: 100vh; min-height: 0; background: #161717; }
    
    .form-container { 
      background: #222B3D; 
      color: #f0f0f0;
      border-right: 1px solid #2d3a54; 
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      flex: 1 1 0; 
      overflow-y: auto; 
      padding: 30px 20px;
      font-family: 'Inter', sans-serif;
    }
    .form-container > div { max-width: 400px; width: 100%; }
    .field-group { margin-bottom: 18px; border-bottom: 1px solid #2d3a54; padding-bottom: 14px; }
    
    label { 
      display: block; font-weight: 700; margin-bottom: 8px; color: #e2e8f0; 
      font-size: 12px; text-transform: uppercase; letter-spacing: 1px; 
    }
    
    input[type="text"], select { 
      width: 100%; padding: 12px; border-radius: 6px; border: 1px solid #2d3a54; 
      background: #0E1426; color: #fff; font-size: 14px; transition: border-color 0.3s;
      font-family: 'Inter', sans-serif; font-weight: 400;
    }
    
    input[type="text"]:focus, select:focus { outline: none; border-color: #2563eb; }

    .buttons { display: flex; gap: 12px; margin-top: 25px; }
    button { 
      flex: 1; padding: 14px; border-radius: 8px; border: none; font-weight: 700; 
      cursor: pointer; font-family: 'Inter', sans-serif; color: #ffffff; 
    }
    .btn-copiar { background: #2563eb; }
    .btn-copiar:hover { background: #1d4ed8; }
    .btn-limpar { background: #2d3a54; }
    
    .plus-button { 
      background: #2563eb; border-radius: 6px; width: 34px; height: 34px; 
      display: flex; align-items: center; justify-content: center; border: none; 
      font-size: 22px; margin-top: 8px; color: #ffffff;
    }

    .checkbox-wrap { 
      display: flex; align-items: center; gap: 8px; font-size: 13px; 
      color: #94a3b8; cursor: pointer; margin-top: 5px; font-weight: 700; 
    }
    input[type="checkbox"] { accent-color: #2563eb; width: 18px; height: 18px; }

    .preview-container { background: #161717; display: flex; align-items: center; justify-content: center; flex: 1 1 0; }
    .whatsapp-message { background: #144D37; color: #e9edef; border-radius: 7.5px; padding: 14px 18px; max-width: 600px; font-size: 18px; line-height: 1.5; white-space: pre-wrap; }
    #previewMsg b { font-weight: bold; }
    .debito-linha { display: flex; gap: 8px; align-items: center; margin-bottom: 10px; }
    .debito-linha input[type="text"] { flex: 1; }
  </style>
</head>
<body>
  <div class="form-container">
    <div>
      <div class="field-group">
        <label>Ve√≠culo</label>
        <div style="display: flex; gap: 6px;">
          <input type="text" id="marca" oninput="atualizarPreview()">
          <input type="text" id="modelo" oninput="atualizarPreview()">
          <input type="text" id="ano" oninput="atualizarPreview()">
        </div>
      </div>

      <div class="field-group">
        <label>Propriet√°rio</label>
        <input type="text" id="proprietario" oninput="atualizarPreview()">
        <label class="checkbox-wrap"><input type="checkbox" id="proprietarioCnpj" onchange="atualizarPreview()"> CNPJ</label>
      </div>

      <div class="field-group">
        <label>Munic√≠pio / Proced√™ncia</label>
        <input type="text" id="emplacadoEm" oninput="atualizarPreview()">
        <label class="checkbox-wrap"><input type="checkbox" id="temAnterior" onchange="atualizarPreview()"> Proced√™ncia anterior</label>
        <input type="text" id="emplacadoAnterior" style="display: none; margin-top:8px;" oninput="atualizarPreview()">
      </div>

      <div class="field-group">
        <label>Financiamento</label>
        <div style="display: flex; gap: 15px; margin-bottom: 10px;">
          <label class="checkbox-wrap"><input type="checkbox" id="temFinanciamento" onchange="atualizarPreview()"> Possui</label>
          <label class="checkbox-wrap"><input type="checkbox" id="financiamentoIncluso" onchange="atualizarPreview()"> A incluir</label>
        </div>
        <div id="financiamentoCampos" style="display: none; flex-direction: column; gap: 8px;">
          <div style="display: flex; gap: 6px;">
            <select id="financiamentoSelect" onchange="document.getElementById('financiamentoInfo').value = this.value; atualizarPreview();" style="flex: 1;">
              <option value="">Banco</option>
              <option value="Aymor√©">Aymor√©</option>
              <option value="Daycoval">Daycoval</option>
              <option value="PAN">PAN</option>
              <option value="C6">C6</option>
              <option value="Votorantim">Votorantim</option>
              <option value="Sicredi">Sicredi</option>
              <option value="Sicoob">Sicoob</option>
              <option value="Digimais">Digimais</option>
              <option value="Bradesco">Bradesco</option>
            </select>
            <input type="text" id="financiamentoInfo" style="flex: 1.5;" oninput="atualizarPreview()">
          </div>
          <input type="text" id="dataContrato" oninput="atualizarPreview()">
        </div>
      </div>

      <div class="field-group">
        <label>Restri√ß√£o Judicial / Adm.</label>
        <label class="checkbox-wrap" style="margin-bottom:10px;"><input type="checkbox" id="temRenajud" onchange="atualizarPreview()"> Possui</label>
        <select id="renajudTipo" style="display: none;" onchange="atualizarPreview()">
          <option value="transfer√™ncia">RENAJUD de transfer√™ncia</option>
          <option value="licenciamento">RENAJUD de licenciamento</option>
          <option value="circula√ß√£o">RENAJUD de circula√ß√£o</option>
          <option value="penhora">RENAJUD de penhora</option>
          <option value="execucao-certidao">Execu√ß√£o por certid√£o</option>
          <option value="administrativa">Administrativa</option>
          <option value="averbacao">Averba√ß√£o</option>
        </select>
      </div>

      <div class="field-group">
        <label>Venda (Inten√ß√£o/Comunica√ß√£o)</label>
        <div style="display: flex; gap: 20px; margin-bottom: 10px;">
          <label class="checkbox-wrap"><input type="checkbox" id="temIntencao" onchange="atualizarPreview()"> Inten√ß√£o</label>
          <label class="checkbox-wrap"><input type="checkbox" id="temComunicacao" onchange="atualizarPreview()"> Comunic.</label>
        </div>
        <input type="text" id="nomeIntencao" style="display: none; margin-bottom:8px;" oninput="atualizarPreview()">
        <input type="text" id="dataInclusaoIntencao" style="display: none;" oninput="atualizarPreview()">
      </div>

      <div class="field-group">
        <label>Observa√ß√µes</label>
        <label class="checkbox-wrap" style="margin-bottom:10px;"><input type="checkbox" id="temObservacao" onchange="atualizarPreview()"> Adicionar</label>
        <input type="text" id="observacaoTexto" style="display: none;" oninput="atualizarPreview()">
      </div>

      <div class="field-group">
        <label>D√©bitos</label>
        <div id="debitosContainer"></div>
        <button class="plus-button" type="button" onclick="adicionarDebito()">+</button>
      </div>

      <div class="field-group">
        <label>Valor total</label>
        <input type="text" id="debitoValor" oninput="atualizarPreview()">
      </div>

      <div class="field-group" style="border-bottom: none;">
        <label>Multas para entrar no sistema</label>
        <div style="display: flex; gap: 6px;">
          <input type="text" id="quantidadeMultas" style="flex: 0.5;" oninput="atualizarPreview()">
          <input type="text" id="valorMultas" style="flex: 1.5;" oninput="atualizarPreview()">
        </div>
      </div>

      <div class="buttons">
        <button class="btn-copiar" onclick="copiarMensagem()">Copiar</button>
        <button class="btn-limpar" onclick="limparCampos()">Limpar</button>
      </div>
    </div>
  </div>
  <div class="preview-container"><div class="whatsapp-message" id="previewMsg"></div></div>

  <script>
    const f = (id) => document.getElementById(id).value;
    const v = (id) => document.getElementById(id).checked;

    function capitalizeWords(str) {
      const dWords = ['de', 'da', 'do', 'das', 'dos'];
      return str.toLowerCase().replace(/(?:^|\s|[.])[a-z√†-√∫]/g, m => m.toUpperCase())
                .replace(/\b([Dd][aeo]s?)\b/g, m => dWords.includes(m.toLowerCase()) ? m.toLowerCase() : m);
    }

    function formatarProprietario(str) {
      let texto = capitalizeWords(str);
      return texto.replace(/\bltda\b/gi, 'LTDA').replace(/\bme\b/gi, 'ME').replace(/\bE\b/g, 'e');
    }

    function onInputCapitalize(e) {
      const start = e.target.selectionStart;
      const newValue = (e.target.id === 'proprietario') ? formatarProprietario(e.target.value) : capitalizeWords(e.target.value);
      if (e.target.value !== newValue) { e.target.value = newValue; e.target.setSelectionRange(start, start); }
    }

    function adicionarDebito() {
      const container = document.getElementById('debitosContainer');
      const count = container.querySelectorAll('.debito-linha').length;
      const linha = document.createElement('div');
      linha.className = 'debito-linha';
      const input = document.createElement('input');
      input.type = 'text'; input.className = 'descricaoDebito'; input.addEventListener('input', atualizarPreview);
      linha.appendChild(input);
      if (count === 0) {
          const cb = document.createElement('input'); cb.type = 'checkbox'; cb.id = 'veiculoEmDiaCheckbox';
          cb.addEventListener('change', atualizarPreview);
          linha.appendChild(cb);
      }
      container.appendChild(linha);
    }

    function formatarValor(valor) {
      const numero = parseFloat(valor.replace(/[^0-9]/g, ''));
      return isNaN(numero) ? '' : 'R$' + numero.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function gerarTextoMensagem() {
      const marca = f('marca'), modelo = f('modelo'), ano = capitalizeWords(f('ano'));
      const empEm = f('emplacadoEm'), empAnt = v('temAnterior') ? f('emplacadoAnterior') : '';
      const prop = formatarProprietario(f('proprietario')), propCnpj = v('proprietarioCnpj');
      const finan = v('temFinanciamento') ? f('financiamentoInfo') : '', finanInc = v('financiamentoIncluso'), dataCont = f('dataContrato');
      const temRen = v('temRenajud'), renTipo = f('renajudTipo');
      const valTot = formatarValor(f('debitoValor')), qtdMul = parseInt(f('quantidadeMultas') || '0'), valMul = formatarValor(f('valorMultas'));
      const diaCb = document.getElementById('veiculoEmDiaCheckbox')?.checked;
      const temInt = v('temIntencao'), temCom = v('temComunicacao'), nomeInt = capitalizeWords(f('nomeIntencao')), dataInt = f('dataInclusaoIntencao');
      const temObs = v('temObservacao'), obsTxt = f('observacaoTexto');

      let msg = `üöó *DADOS DO VE√çCULO*\n`;
      if (marca || modelo || ano) msg += `‚Ä¢ *Modelo:* ${marca} ${modelo} ${ano}\n`;
      if (prop) msg += `‚Ä¢ *Propriet√°rio:* ${prop}${propCnpj ? ' (CNPJ)' : ''}\n`;
      if (empEm) msg += `‚Ä¢ *Munic√≠pio:* ${empEm}${empAnt ? ` (Proced√™ncia anterior: ${empAnt})` : ''}\n`;

      msg += `\n‚ö†Ô∏è *RESTRI√á√ïES E PEND√äNCIAS*\n`;
      let statusFinan = finanInc ? "a ser inclu√≠do" : "ativo";
      msg += `‚Ä¢ *Aliena√ß√£o:* ${finan ? `Possui financiamento ${statusFinan} (Banco *${finan}*${dataCont ? ', contrato de ' + dataCont : ''})` : "N√£o possui"}\n`;

      let txtRen = "N√£o possui";
      if (temRen) {
        txtRen = renTipo === 'execucao-certidao' ? "Possui restri√ß√£o de execu√ß√£o por certid√£o" : 
                 renTipo === 'administrativa' ? "Possui restri√ß√£o administrativa" : 
                 renTipo === 'averbacao' ? "Possui averba√ß√£o de execu√ß√£o por certid√£o" : `Consta bloqueio RENAJUD de ${renTipo}`;
        txtRen += " üö´";
      }
      msg += `‚Ä¢ *Restri√ß√£o Judicial:* ${txtRen}\n`;

      let txtVenda = "N√£o possui";
      if ((temInt || temCom) && nomeInt) {
        txtVenda = `${temInt && temCom ? 'Inten√ß√£o/Comunica√ß√£o' : temInt ? 'Inten√ß√£o' : 'Comunica√ß√£o'} registrada para ${nomeInt}${dataInt ? ` em ${dataInt}` : ''}`;
      }
      msg += `‚Ä¢ *Venda:* ${txtVenda}\n`;

      if (temObs && obsTxt) msg += `\nüîç *OBSERVA√á√ïES*\n‚Ä¢ ${obsTxt}\n`;

      msg += `\nüí∞ *D√âBITOS*\n`;
      if (diaCb) msg += `‚Ä¢ Ve√≠culo em dia (2025)\n`;

      const debs = Array.from(document.querySelectorAll('.descricaoDebito')).map(i => i.value.trim()).filter(v => v);
      if (debs.length > 0) {
        debs.forEach((d, i) => msg += `‚Ä¢ ${d}${i === debs.length - 1 ? ' =' : ' +'}\n`);
        if (valTot) msg += `‚Ä¢ *VALOR TOTAL:* ${valTot}\n`;
      } else if (!diaCb) {
        msg += `‚Ä¢ Sem d√©bitos, ve√≠culo em dia (2026)\n`;
      }

      if (qtdMul > 0) {
        let txtM = qtdMul === 1 ? '1 multa que ainda n√£o caiu no sistema' : `${qtdMul} multas que ainda n√£o ca√≠ram no sistema`;
        msg += `\n‚Ä¢ ${txtM}${valMul ? ` (valor total de ${valMul})` : ''}\n`;
      }

      return msg.trim();
    }

    function atualizarPreview() {
      const m = gerarTextoMensagem();
      document.getElementById('previewMsg').innerHTML = m.replace(/\*([^\*]+)\*/g, '<b>$1</b>');
      document.getElementById('nomeIntencao').style.display = document.getElementById('dataInclusaoIntencao').style.display = (v('temIntencao') || v('temComunicacao')) ? 'block' : 'none';
      document.getElementById('observacaoTexto').style.display = v('temObservacao') ? 'block' : 'none';
      document.getElementById('emplacadoAnterior').style.display = v('temAnterior') ? 'block' : 'none';
      document.getElementById('financiamentoCampos').style.display = v('temFinanciamento') ? 'flex' : 'none';
      document.getElementById('renajudTipo').style.display = v('temRenajud') ? 'block' : 'none';
    }

    function copiarMensagem() {
      navigator.clipboard.writeText(gerarTextoMensagem()).then(() => alert('‚úÖ'));
    }

    function limparCampos() {
      document.querySelectorAll('input[type="text"]').forEach(i => i.value = '');
      document.querySelectorAll('input[type="checkbox"]').forEach(c => c.checked = false);
      document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
      document.getElementById('debitosContainer').innerHTML = '';
      for(let i=0; i<3; i++) adicionarDebito();
      atualizarPreview();
    }

    window.onload = () => {
      document.querySelectorAll('input[type="text"]').forEach(i => {
        if (!['marca','modelo','observacaoTexto','financiamentoInfo','emplacadoAnterior','emplacadoEm','quantidadeMultas','valorMultas'].includes(i.id)) i.addEventListener('input', onInputCapitalize);
      });
      for(let i=0; i<3; i++) adicionarDebito();
      atualizarPreview();
    };
  </script>
</body>
</html>
